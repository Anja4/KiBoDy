<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Thing</title>
	<style type='text/css'>
		canvas { border: 1px solid black; }
	</style>
</head>
<body>
	<h1>Mouse and Pictures</h1>
	<canvas id='canvas' width='800' height='600'></canvas>
	<script type='text/javascript'>
	
	var can = document.getElementById('canvas');
	var ctx;
	var lastTickTime = 0;
	var UPDATEINTERVAL = 1000 / 30;
	var accumulate = 0;
	var GAME = 0;
	var MENU = -1;
	var update;
	var draw;
	
	var spider= new Image();
	var beedog=new Image();
	
	var baddies = [];
	var bullets = [];
	var trees = [];
	var go=false;
	var playButton={x:300,y:350,w:200,h:70}
	var introButton={x:300,y:450,w:200,h:70}
	var mouse = { x: 0, y: 0, clicked: false };

	var player = {
		x: 0,
		y: 0,
		speed: 100, //speed is measured in pixels per second
		angle: 0,
		width: 50,
		height: 50,
		up: false,
		down: false,
		left: false,
		right: false,
		};
	
	//****************************INTRO********************
	function introUpdate(time){
	
	}
	function introDraw(){
		ctx.clearRect(0,0,800,600)
		ctx.fillStyle="black"
		ctx.fillRect(0,0,800,600)
		ctx.fillStyle="white"
		ctx.font="18pt serif"
		ctx.fillText("The year is 2093.",100,100)
		ctx.fillText("The world is in ruins.",100,150);
		ctx.fillText("One can't walk but 10 feet without being killed by a Mecha-Mitchell.",100,200)
		ctx.fillText("Only one man can save the world.",100,250)
		ctx.fillText("That man is Kibody, the Tree Master.",100,300)
	}
	function introSetup(){
	
	}
	//****************************MENU***********
	function menuUpdate(time){
		if ( mouse.clicked && contains(playButton, mouse) === true ) {
			update = playUpdate;
			draw = playDraw;
			playSetup();
		}
		if ( mouse.clicked && contains(introButton, mouse) === true ) {
			update = introUpdate;
			draw = introDraw;
			introSetup();
		}
	}
	function menuDraw(){
		ctx.clearRect(0,0,can.width,can.height);
		ctx.fillStyle="green";
		ctx.fillRect(300,350,200,70);
		ctx.fillRect(introButton.x,introButton.y,introButton.w,introButton.h)
		ctx.font="30pt Helvetica";
		ctx.fillStyle="black";
		ctx.fillText("Play!",340,400);
		ctx.fillText("Story!",340,500);
		ctx.font="30pt Cursive";
		ctx.fillText("Game Thingy 1.6!",250,100);
	}
	function menuSetup(){
		update = menuUpdate;
		draw = menuDraw;
	}
	//*************************PLAY FUNCTIONS****************************
	
	
	
	
	
	function playUpdate(time){
		//*****This code moves the player*****
		if(player.up || player.down || player.right || player.left){
			var vert = 0;
			var horz = 0;
			if(player.left)
				horz--;
			if(player.right)
				horz++;
			if(player.up)
				vert--;
			if(player.down)
				vert++;
			var angle = Math.atan2(vert,horz);
			if(horz != 0)
				player.x += Math.cos(angle) * player.speed * time * 0.001;
			if(vert !=0)
				player.y += Math.sin(angle) * player.speed * time * 0.001;
		}
		
		//*****This code moves all the baddies*****
		for(var i = 0; i < baddies.length; i++){
			var xx = can.width / 2;
			var yy = can.height / 2;
			var angle = Math.atan2(yy - baddies[i].y, xx - baddies[i].x);
			baddies[i].x += Math.cos(angle) * baddies[i].speed * time * 0.001;
			baddies[i].y += Math.sin(angle) * baddies[i].speed * time * 0.001;
		}
		
		//******This code moves the bullets*****
		for(var i = 0; i < bullets.length; i++){
			var xx = can.width / 2;
			var yy = can.height / 2;
			bullets[i].x += Math.cos(bullets[i].angle) * bullets[i].speed * time * 0.001;
			bullets[i].y += Math.sin(bullets[i].angle) * bullets[i].speed * time * 0.001;
		}
		
		//Collision detection with walls
		if(player.x < 0)
			player.x = 0;
		else if(player.x + player.width > can.width)
			player.x = can.width - player.width;
		if(player.y < 0)
			player.y = 0;
		else if(player.y + player.height > can.height)
			player.y = can.height - player.height;
			
		//*****end of the player movent code*****
	}
	
	function playDraw(){
		ctx.clearRect(0,0,can.width, can.height);
		
		ctx.fillStyle = "#FF0000";
		
		//ctx.fillRect(player.x, player.y, player.width, player.height);
		ctx.drawImage(beedog,player.x,player.y);
		
		ctx.fillStyle = "#FF0000";
		for(var i = 0; i < baddies.length; i++){
			//ctx.fillRect(baddies[i].x,baddies[i].y,baddies[i].width,baddies[i].height);
			ctx.drawImage(spider,baddies[i].x,baddies[i].y);
		}
		//ctx.fillStyle = "#FFFF00";
		for(var j = 0; j < bullets.length; j++){
			ctx.fillRect(bullets[j].x,bullets[j].y,bullets[j].width,bullets[j].height);
		}
		
		//ctx.fillText("" + lastTickTime,100,100); //This is test code, used to show the time
	}
	
	//Starting position
	function playSetup(){
		update = playUpdate;
		draw = playDraw;
		
		player.x = 10;
		player.y = 10;
		player.x = 10;
		player.y = 10;
		addBaddie();
		addBaddie();
		addBaddie();
		addBaddie();
		addBaddie();
		addBullet(0,0,Math.atan2(50,100));
		addBullet(0,0,Math.atan2(90,100));
		addBullet(0,0,Math.atan2(80,100));
		addBullet(0,0,Math.atan2(70,100));
		addBullet(0,0,Math.atan2(60,100));
		spider.src="face-small.png";
		beedog.src="beedog.png";
	}
	
	function addBaddie(){
		var rand = Math.floor(Math.random() + 0.5);
		var rand2 = Math.floor(Math.random() + 0.5);
		var xx = 0;
		var yy = 0;
		if(rand == 0){ // the x is random
			xx = Math.random() * can.width;
			if(rand2 == 0)
				yy = 0;
			else
				yy = can.height;
		}
		else{ //the y is random
			yy = Math.random() * can.height;
			if(rand2 == 0)
				xx = 0;
			else
				xx = can.width;
		}
		
		baddies.push({
			x: xx,
			y: yy,
			width: 50,
			height: 50,
			speed: 30,
			health: 100,
			});
	}
	
	function addBullet(xx,yy,anglei){
		bullets.push({
			x: xx,
			y: yy,
			width: 5,
			height: 5,
			speed: 300,
			angle: anglei,
			damage: 25,
			});
	}
	
	
	
	//*********************End of play functions***************
	
	
	
	//*****code to tell time
	function tick(time){
		var deltaTime = time - lastTickTime;
		
		draw();
		
		accumulate += deltaTime;
		
		while(accumulate >= UPDATEINTERVAL){
			update(UPDATEINTERVAL);
			accumulate -= UPDATEINTERVAL;
		}
		
		lastTickTime = time;
		window.requestAnimationFrame(tick);
	}
	
	//****Handling buttons being pressed**
	function handleKeyDown(evt){
		if(evt.keyCode == 87)//w
			player.up = true;
		if(evt.keyCode == 83)//s
			player.down = true;
		if(evt.keyCode == 65)//a
			player.left = true;
		if(evt.keyCode == 68)//d
			player.right = true;
		if(evt.keyCode == 32)//space
			go = true;
			
		if(32 <= evt.keyCode && evt.keyCode >= 90)
			evt.preventDefault();
	}
	
	function handleKeyUp(evt){
		if(evt.keyCode == 87)//w
			player.up = false;
		if(evt.keyCode == 83)//s
			player.down = false;
		if(evt.keyCode == 65)//a
			player.left = false;
		if(evt.keyCode == 68)//d
			player.right = false;
		if(evt.keyCode == 32)//space
			go = false;
			
		if(32 <= evt.keyCode && evt.keyCode >= 90)
			evt.preventDefault();
	}
	function getClick(e) {
		var evt = e || window.event;
		mouse.x = evt.pageX - ctx.canvas.offsetLeft;
		mouse.y = evt.pageY - ctx.canvas.offsetTop;
		mouse.clicked = true;
	}
	function contains( r, m ) {
		return ! (r.x>m.x || r.y>m.y || m.x>r.x+r.w || m.y>r.y+r.h );
	}
	
	//****End handling buttons being pressed**
	
	
	function main(){
		ctx = document.getElementById('canvas').getContext("2d");
		menuSetup();
		
		window.requestAnimationFrame(tick);
	}
	
	document.addEventListener('click', getClick);
	document.addEventListener('keydown', handleKeyDown);
	document.addEventListener('keyup', handleKeyUp);
	
	main();
	
	</script>
</html>
